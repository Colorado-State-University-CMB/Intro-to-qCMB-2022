---
title: "Data Manipulation and Visualization with COVID-19"
author: ""
date: "2/14/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE)
```

`coronavirus`is an R package created and curated by Ramin Krispin and Jerret Byrnes and 
has been uploaded to the [CRAN repository](https://cran.r-project.org/web/packages/coronavirus/readme/README.html). 
Currently, it contains two data sets, `coronavirus` & `covid19_vaccine`, that are 
updated daily and have data on cases, deaths, vaccinations, population, 
and countries among other geospatial data. Notice that the `coronavirus` data 
and `coronavirus` package share the same name. You'll be able to distinguish the
package in R Studio via the `::` in `coronavirus::` when typed within an R chunk.

### `coronavirus` data set: Monday February 14, 2022
We'll begin with the `coronavirus` data set. To manipulate and visualize our date, 
we'll need to load a few other packages (`tidyverse`, `plotly`, `DT`) which contain
the tools we need to query and analyze the data.

## 1 Parsing through our data
#### 1.1 Open our toolbox
Let's begin by installing the package and a few tools with the `install.packages()` & `library()` functions
```{r}
# Use quotes "" for installing packages

#install.packages("tidyverse")
#install.packages("plotly")
#install.packages("DT")
#install.packages("coronavirus")

# Load them in
library(tidyverse)
library(plotly) # interactive maps and charts
library(DT) # interactive data tables
library(coronavirus)

```

#### 1.2 Let's take a look at the data
```{r}
#coronavirus
head(coronavirus)
tail(coronavirus)
str(coronavirus)
```
#### 1.3 Diving a bit deeper
```{r}
# How many countries are listed in the data?
coronavirus %>%
  select(country) %>%
  unique() %>%
  count()

# Running this code however WON'T count the number of cases 
coronavirus %>%
  select(cases) %>%
  count()

# Using the the sum() function can tell us total number of cases in the data set. This is possible because the "cases" vector is a numeric
                    coronavirus %>%
                      select(cases) %>%
                      sum()
                    
                    # coronavirus %>%
                    #   select(type) %>%
                    #   sum()

# How about cases in the US only?
coronavirus %>%
  filter(country == "US") %>%
  select(cases) %>%
  sum()
  
```

#### 1.4 Are there any missing values 
```{r}

any(is.na(coronavirus))

# How many?
sum(is.na(coronavirus))

# Where are the NA's?
colSums(is.na(coronavirus))

# Location of each NA?
#which(is.na(coronavirus$population))

```

#### 1.5 What if we wanted to `sum()` the observations within a character vector?
```{r}
# Remember, we can only use the sum() function on numerics
# coronavirus %>%
#   select(type) %>%
#   sum()

# There are three unique observations within the "type" character vector
coronavirus %>%
  select(type) %>%
  unique() 

# So lets query our data to count "confirmed", "death", and  "recovery" observations within the "type" character vector.
coronavirus %>%
  group_by(type) %>% 
  summarise(cases = sum(cases))

```

#### 1.6 Save this as a data frame to use later
```{r}
total_cases <- coronavirus %>%
  filter(type != "recovery") %>% # "!=" (not equal to)
  group_by(type) %>%
  summarise(cases = sum(cases)) %>%
  mutate(type = factor(type, levels = c("confirmed", "death"))) # Factors are used to represent categorical data which cannot be done with a character vector

total_cases
```

## 2 Interactive data table
```{r}
coronavirus %>%
  filter(type != "recovery") %>%
  group_by(type, country) %>%
  summarise(cases = sum(cases), .groups = "drop") %>%
  mutate(type = factor(type, levels = c("confirmed", "death"))) %>%
  pivot_wider(names_from = type, values_from = cases) %>%
  mutate(death_rate = death / confirmed) %>%
  filter(!is.na(country)) %>%
  arrange(-death_rate) %>%
  datatable(rownames = FALSE,
            colnames = c("Country", "Confrimed Cases", "Death Cases","Death Rate %")) %>%
  formatPercentage("death_rate", 0)


# df <- coronavirus %>%
#   filter(type != "recovery") %>%
#   group_by(date,type) %>%
#   summarise(total = sum(cases), .groups = "drop")
# 
# p_1 <- plot_ly(data = df %>% filter(type == "confirmed"),
#         x = ~ date,
#         y = ~ total,
#         name = "Confirmed",
#         type = "scatter",
#         mode = "line") %>%
#   layout(yaxis = list(title = "Cases"),
#          xaxis = list(title = ""))
# 
# p_2 <- plot_ly(data = df %>% filter(type == "death"),
#               x = ~ date,
#               y = ~ total,
#               name = "Death",
#               line = list(color = "red"),
#               type = "scatter",
#               mode = "line") %>%
#   layout(yaxis = list(title = "Cases"),
#          xaxis = list(title = "Source: Johns Hopkins University Center for Systems Science and Engineering"))
# 
# subplot(p_1, p_2, nrows = 2, 
#               titleX = TRUE,
#               titleY = TRUE) %>%
#   layout(title = "Worldwide - Daily Confirmed and Death Cases",
#          margin = list(t = 60, b = 60, l = 40, r = 40),
#          legend = list(x = 0.05, y = 1)
#          )
```

```{r}

```


```{r}

```

```{r}

```


```{r}

```

